"use strict";(self.webpackChunkbutlr_integrations=self.webpackChunkbutlr_integrations||[]).push([[658],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>f});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},l=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=u(n),f=o,d=m["".concat(i,".").concat(f)]||m[f]||p[f]||a;return n?r.createElement(d,c(c({ref:t},l),{},{components:n})):r.createElement(d,c({ref:t},l))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,c=new Array(a);c[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,c[1]=s;for(var u=2;u<a;u++)c[u]=n[u];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3332:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={sidebar_position:1},c="Current Occupancy - Traffic Sensors",s={unversionedId:"tutorials/OccupancyTraffic",id:"tutorials/OccupancyTraffic",title:"Current Occupancy - Traffic Sensors",description:"Introduction",source:"@site/docs/tutorials/OccupancyTraffic.md",sourceDirName:"tutorials",slug:"/tutorials/OccupancyTraffic",permalink:"/docs/tutorials/OccupancyTraffic",draft:!1,editUrl:"https://github.com/butlrtechnologies/butlrtechnologies.github.io/tree/main/docs/tutorials/OccupancyTraffic.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Current Occupancy - Presence Sensors",permalink:"/docs/tutorials/OccupancyPresence"},next:{title:"GraphQL - Basics",permalink:"/docs/category/graphql---basics"}},i={},u=[{value:"Introduction",id:"introduction",level:2},{value:"1 - Get Access Token",id:"1---get-access-token",level:2},{value:"2 - Query occupancy for rooms with traffic sensors",id:"2---query-occupancy-for-rooms-with-traffic-sensors",level:2},{value:"3 - Calculate Estimated Occupancy based on traffic sensors",id:"3---calculate-estimated-occupancy-based-on-traffic-sensors",level:2},{value:"Closing Remarks",id:"closing-remarks",level:2}],l={toc:u};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"current-occupancy---traffic-sensors"},"Current Occupancy - Traffic Sensors"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Traffic sensors are often placed at the door line of a room. They measure the number of people entering and exiting the field of view. When calculating occupancy for rooms with traffic sensors, this measurement is often referred to as ",(0,o.kt)("inlineCode",{parentName:"p"},"estimated occupancy"),". Traffic sensors cannot explicitly tell you how many people are in the room, but they can tell you how many people are entering and exiting the room. The occupancy for a room (",(0,o.kt)("inlineCode",{parentName:"p"},"estimated occupancy"),") with traffic sensors is the sum of enters minus the sum of exits since the start of the day."),(0,o.kt)("h2",{id:"1---get-access-token"},"1 - ",(0,o.kt)("a",{parentName:"h2",href:"/docs/tutorials/GetAccessToken"},"Get Access Token")),(0,o.kt)("h2",{id:"2---query-occupancy-for-rooms-with-traffic-sensors"},"2 - Query occupancy for rooms with traffic sensors"),(0,o.kt)("p",null,"It's important to start the query from the beginning of the day, since you want to capture traffic from the start. "),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": The ",(0,o.kt)("inlineCode",{parentName:"p"},"filter.start")," request parameter is in ",(0,o.kt)("inlineCode",{parentName:"p"},"UTC")," time.  It's important to know your timezone to get the right start of the day."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl --location --request POST \'https://api.butlr.io/api/v3/reporting\' \\\n--header \'Authorization: Bearer your_access_token\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "group_by": {\n        "order": ["room_id", "field"]\n    },\n    "window": {\n        "every": "1h",\n        "function": "sum"\n    },\n    "filter": {\n        "start": "2022-11-04T00:00:00Z",\n        "measurements": ["traffic"]\n    }\n}\'\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "data": {\n        "room_xxx1": {\n            "in": {\n                "sum": 10,\n                "min": 4,\n                "max": 6,\n                "count": 2,\n                "mean": 5,\n                "median": 6,\n                "stddev": 1,\n                "first": 4,\n                "last": 6\n            },\n            "out": {\n                "sum": 11,\n                "min": 1,\n                "max": 5,\n                "count": 3,\n                "mean": 3.6666666666666665,\n                "median": 5,\n                "stddev": 1.8856180831641267,\n                "first": 1,\n                "last": 5\n            }\n        },\n        "room_xxx2": {\n            "in": {\n                "sum": 10,\n                "min": 2,\n                "max": 6,\n                "count": 3,\n                "mean": 3.3333333333333335,\n                "median": 2,\n                "stddev": 1.8856180831641267,\n                "first": 6,\n                "last": 2\n            },\n            "out": {\n                "sum": 7,\n                "min": 1,\n                "max": 3,\n                "count": 5,\n                "mean": 1.4,\n                "median": 1,\n                "stddev": 0.8,\n                "first": 1,\n                "last": 1\n            }\n        }\n    }\n}\n')),(0,o.kt)("h2",{id:"3---calculate-estimated-occupancy-based-on-traffic-sensors"},"3 - Calculate Estimated Occupancy based on traffic sensors"),(0,o.kt)("p",null,"Our intention is to estimate the occupancy of a room based on number of enters and exits.  We can do this by subtracting the sum of exits from the sum of enters. The following code snippet shows how to calculate the estimated occupancy for each room."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function estOccupancyByTraffic(response) {\n    let occupancy = {};\n\n    // return empty if no data is available\n    if (!response?.data) {\n        return occupancy;\n    }\n\n    // loop over all rooms\n    // ex. { room_xxx1: { in: { sum: 10, ... }, out: { sum: 11, ... } }, room_xxx2: { in: { sum: 10, ... }, out: { sum: 7, ... } } }\n    const data = response.data;\n    for (const room_id in data) {\n        const enters = data[room_id]?.in?.sum || 0;\n        const exits = data[room_id]?.out?.sum || 0;\n\n        // we cannot have negative occupancy\n        occupancy[room_id] = exits > enters ? 0 : enters - exits;\n    }\n\n    return occupancy;\n}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "room_xxx1": 0,\n    "room_xxx2": 3\n}\n')),(0,o.kt)("h2",{id:"closing-remarks"},"Closing Remarks"),(0,o.kt)("p",null,"This is a very basic example of how to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"/v3/reporting")," API to calculate ",(0,o.kt)("inlineCode",{parentName:"p"},"estimated occupancy"),". If you have any questions, please reach out to us at ",(0,o.kt)("a",{parentName:"p",href:"mailto:support@butlr.io"},"support@butlr.io"),"."))}p.isMDXComponent=!0}}]);